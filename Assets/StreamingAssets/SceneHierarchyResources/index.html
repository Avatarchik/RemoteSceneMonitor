<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
<HEAD>
  <TITLE> ZTREE DEMO </TITLE>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" href="css/zTreeStyle/zTreeStyle.css" type="text/css">
  <style>
    body {
      background-color: white;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    div, p, table, th, td {
      list-style: none;
      margin: 0;
      padding: 0;
      color: #333;
      font-size: 12px;
      font-family: dotum, Verdana, Arial, Helvetica, AppleGothic, sans-serif;
    }

    #testIframe {
      margin-left: 10px;
    }
  </style>
  <script type="text/javascript" src="js/jquery-1.4.4.min.js"></script>
  <script type="text/javascript" src="js/jquery.ztree.core.js"></script>
	<script type="text/javascript" src="js/jquery.ztree.excheck.js"></script>
	<script type="text/javascript" src="js/jquery.ztree.exedit.js"></script>
  <SCRIPT type="text/javascript">
    <!--
    var zTree;
    var demoIframe;

    var setting = {
      view: {
        dblClickExpand: false,
        showLine: true,
        selectedMulti: false
      },
      data: {
        simpleData: {
          enable: true,
          idKey: "id",
          pIdKey: "pId",
          rootPId: ""
        }
      },
      edit: {
				enable: true,
				showRemoveBtn: true,
				showRenameBtn: false,
        drag: {
          isCopy: false,
          isMove: true,
          prev: true,
          iner: true,
          next: true,
        }
			},
      callback: {
        beforeClick: function (treeId, treeNode) {
          var zTree = $.fn.zTree.getZTreeObj("tree");
          if (treeNode.isParent) {
          //  zTree.expandNode(treeNode);
            window.open("id" + treeNode.id  , "testIframe");
            return false;
          } else {
            //demoIframe.attr("src", treeNode.file + ".html");
            window.open("id" + treeNode.id  , "testIframe");
            return true;
          }
        },
        beforeDrag: beforeDrag,
				beforeDrop: beforeDrop,

				onRemove: onRemove,
      }
    };

    function onRemove(e, treeId, treeNode) {

      var url = "/action/delete/" + treeNode.id;

      var xhr = new XMLHttpRequest();
      xhr.open('GET', url, true);
      xhr.send();
		}

    function beforeDrag(treeId, treeNodes) {
			for (var i=0,l=treeNodes.length; i<l; i++) {
				if (treeNodes[i].drag === false) {
					return false;
				}
			}
			return true;
		}
		function beforeDrop(treeId, treeNodes, targetNode, moveType) {
      moveNode(treeNodes[0].id,targetNode.id);
			return targetNode ? targetNode.drop !== false : true;
		}

    function moveNode(idDragNode , idTargetNode){

      var url = "/action/move/" + idDragNode + "/" + idTargetNode;

      var xhr = new XMLHttpRequest();
      xhr.open('GET', url, true);
      xhr.responseType = 'json';
      xhr.send();
    }

    var getJSON = function(url, callback) {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', url, true);
      xhr.responseType = 'json';
      xhr.onload = function() {
        var status = xhr.status;
        if (status === 200) {
          callback(null, xhr.response);
        } else {
          callback(status, xhr.response);
        }
      };
      xhr.send();
    };

    function CreateNodeThree(jsonNodes){
      var zNodes;
      var sceneNode = { id:threeNode.instanceId, pId:0, name:jsonNodes.name};

      CreateNode(jsonNodes , arrayNodes);
    }

    function CreateNode(threeNode , array){
      var zNodesChild;
      var zNode = { id:threeNode.instanceId, pId:0, name:"leaf node 03"};
    }


      function setEdit() {
    			var zTree = $.fn.zTree.getZTreeObj("tree"),
    			remove = $("#remove").attr("checked"),
    			rename = $("#rename").attr("checked"),
    			removeTitle = $.trim($("#removeTitle").get(0).value),
    			renameTitle = $.trim($("#renameTitle").get(0).value);
    			zTree.setting.edit.showRemoveBtn = remove;
    			zTree.setting.edit.showRenameBtn = rename;
    			zTree.setting.edit.removeTitle = removeTitle;
    			zTree.setting.edit.renameTitle = renameTitle;
    			showCode(['setting.edit.showRemoveBtn = ' + remove, 'setting.edit.showRenameBtn = ' + rename,
    				'setting.edit.removeTitle = "' + removeTitle +'"', 'setting.edit.renameTitle = "' + renameTitle + '"']);
    	}

    $(document).ready(function () {
      /*
      var t = $("#tree");
      t = $.fn.zTree.init(t, setting, zNodes);
      demoIframe = $("#testIframe");
      demoIframe.bind("load", loadReady);
      var zTree = $.fn.zTree.getZTreeObj("tree");
      zTree.selectNode(zTree.getNodeByParam("id", 101));
      */
    //  var zTree = $("#tree");

      getJSON("/json/hierarhy" , function(err , data){
        if(err === null){
          //alert(data.rootNode.lenght);
          //$.fn.zTree.init($("#treeDemo"), setting, data.rootNode);

        //  CreateNodeThree(data.rootNode);
          var t = $("#tree");
          t = $.fn.zTree.init(t, setting, data.rootNode);
          setEdit();
          //t.setting.edit.drag.isMove = true;
        }
      })
    });

    //-->
  </SCRIPT>
</HEAD>

<BODY>
<TABLE border=0 height=200px align=left>
  <TR>
    <TD width=270px align=left valign=top style="BORDER-RIGHT: #999999 1px dashed">
      <ul id="tree" class="ztree" style="width:260px; overflow:auto;"></ul>
    </TD>

    <TD width=770px align=left valign=top>
      <IFRAME ID="testIframe" Name="testIframe" FRAMEBORDER=0 SCROLLING=AUTO width=100% height=600px
              SRC="core/standardData.html"></IFRAME>
    </TD>
  </TR>
</TABLE>

</BODY>
</HTML>
